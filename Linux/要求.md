47.93.11.51

## 1.恶意进程检测

1. 在**5s**内如果某一进程的**CPU**或者内存占用超过**50%**，视为恶意进程
2. 第一次检测时，获取所有可能的恶意进程
3. 如果第一次检测时有潜在恶意进程，等待**5s**继续检测
4. 如果潜在恶意进程仍然占超过阈值的资源，视为恶意进程

**输出样式**

```
2018-09-12__10:31:09 ./2 8400 snowfla+ 99.60% 0.00%
```

数据项分别为：时间 进程名 PID 用户 CPU占用 内存占用

验收标准

**请参照以下几点：**

​     **1.使用eval**

​     **2.使用ps命令**

​     **3.简单期间，CPU占用可按照单核计算**

每秒执行

```shell
/bin/sleep 1
```



比较大小

```shell
a=`expr $cpuUse \> 3.0`
```

输出

```shell

```



## 2.用户统计

eval `df -T -m -x tmpfs -x devtmpfs | tail -n +2 | awk -v DiskSum=0 -v DiskLeft=0 '{printf("Pname["NR"]=%s;Psum["NR"]=%d;Pleft["NR"]=%d;Puseperc["NR"]=%s", $7,$3,$4,$6); DiskSum+=$3; DiskLeft+=$5} END {printf("Pnum=%d;DiskSum=%d;DiskLeft=%d;", NR, DiskSum, DiskLeft)}'`

时间 用户总数（非系统用户）近期活跃用户（3个） 具有ROOT权限用户 当前在线用户_登录IP_TTY

[suyelu_IP_TTY,sd_ip_tty]

[suyelu,pi2]

**注意**：

用户相关的数据都用中括号括起来，每一个元素用逗号分割。请参看验收标准的输出样式。

![img](http://47.93.11.51/zentao/file-read-23.png)



```shell
cat /etc/passwd | grep -v nologin | grep -v halt | grep -v shutdown | wc -l
```



```shell
last | awk -F ' ' '{print $1}' | head -n -2 | sort -u | wc -l
```



## 3.系统运行概况

时间 主机名 OS版本 内核版本 运行时间 平均负载 磁盘总量 磁盘已用% 内存大小 内存已用% CPU温度 磁盘报警级别 内存报警级别 CPU报警级别

**报警级别**

|              | normal | note  | warning |
| :----------- | :----- | :---- | :------ |
| 磁盘(百分比) | 0-80   | 80-90 | 90-100  |
| CPU(温度)    | 0-50   | 50-70 | 70-100  |
| MEM(百分比)  | 0-70   | 70-80 | 80-100  |



请按照上述样式输出。

验收标准

输出样例：

![img](http://47.93.11.51/zentao/file-read-22.png)



## 4.CPU信息获取：

时间 负载1（1分钟） 负载2（5分钟） 负载3（15分钟） 占用率 （时间间隔0.5） 当前温度 警告（normal，note（50-70），warning（70~））



该脚本主要用以获取CPU信息，请按照上述样式输出。

**注意：请使用文件获取CPU占用率，不要使用其他命令获取**

相关文件：/proc/loadavg

/sys/class/thermal/thermal_zone0/temp

/proc/stat

验收标准

![img](http://47.93.11.51/zentao/file-read-21.png)



```shell
#!/bin/bash


#时间 主机名 OS版本 内核版本 运行时间 平均负载 磁盘总量 磁盘已用% 内存大小 内存已用% CPU温度 磁盘报警级别 内存报警级别 CPU报警级别


echo -n `date "+%Y-%m-%d__%H:%M:%S"`

echo -n " " `uname -n`
echo -n " " `uname -v`
echo -n " " `uname -r`

echo -n "up" `uptime | awk -F "up" '{print $2}' | awk -F "," '{print $1}'`
echo -n `uptime | awk -F ":" '{print $4}'`

diskSum=`df -kl|awk '{print $2,$3}'|sed '1d'|awk '{sum += $1};END {print sum}'`
diskUse=`df -kl|awk '{print $2,$3}'|sed '1d'|awk '{sum += $2};END {print sum}'`
diskPcent=`expr $diskUse \* 100 / $diskSum`

echo -n " " $diskSum" "$diskPcent"%"

memSum=`free | awk 'NR==2 {print $2}'`
memUse=`free | awk 'NR==2 {print $3}'`
memPcent=`expr $memUse \* 100 / $memSum`

echo -n " "$memSum" "$memPcent"%"

tempout=`sensors | grep 'Core 0' | awk -F ": +" '{print $2}' | awk -F " " '{print $1}'`
temp=`sensors | grep 'Core 0' | awk -F ": +" '{print $2}' | awk -F "+" '{print $2}' | awk -F "." '{print $1}'`

echo -n " "$tempout

if [ $memPcent -le 80 ]; then
	echo -n " "normal" "
elif [ $memPcent -le 90 ]; then
	echo -n " "note" "
else 
	echo -n " "warning" "
fi

if [ $diskPcent -le 50 ]; then
	echo -n normal" "
elif [ $diskPcent -le 50 ]; then
	echo -n note" "
else
	echo -n warning" "
fi

if [ $temp -le 70 ]; then
	echo normal
elif [ $tem -le 80 ]; then
	echo note
else
	echo warning
fi

```



## 5.MEM内存信息获取

在树莓派上，使用Shell编程，输出以下内存信息：

| 时间                 | 总量  | 剩余量 | 当前占用（%） | 占用百分比动态平均值 |
| :------------------- | :---- | :----- | :------------ | :------------------- |
| 2018-01-12__15:00:28 | 1023M | 200M   | 80.4%         | 60.8%                |

##  

动态平均值=0.3动态平均值（上一次）+0.7当前占用比

在脚本编写过程中，可以参考以下内容：

awk '{printf("%s %s",$1,$2)}'

echo "scale=1;0.3*24+0.7*36" | bc

arry=(a c d e f)

arry=($1 $2)

验收标准

脚本完成后，用参数的形式向脚本传入上次的动态平均值。

执行后输出以下格式的输出：

![img](http://47.93.11.51/zentao/file-read-2.png)



## 6.DISK

1. 磁盘总量
2. 磁盘剩余量
3. 占用比例
   1. 各分区占用比例
   2. 各分区总量
   3. 分区剩余情况

2018-01-12__16:48:23 标识（0为整个磁盘，1为分区） 磁盘还是分区（disk| /boot , /） 磁盘/分区总量 磁盘/分区剩余量 占用比例

验收标准

[![img](http://47.93.11.51/zentao/file-read-438.png)](http://47.93.11.51/zentao/file-read-438.png)
前两行为两个分区，最后一行为整个磁盘。